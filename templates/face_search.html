<!DOCTYPE html>
<html>
<head>
    <title>Face Search</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body{
            background:#0f2027;
            color:white;
            font-family:Arial;
        }

        .container{
            max-width:900px;
            margin:auto;
            padding:20px;
        }

        .card{
            background:rgba(255,255,255,0.08);
            padding:20px;
            border-radius:12px;
            margin-top:20px;
            text-align:center;
        }

        .btn{
            background:#28a745;
            color:white;
            padding:10px 18px;
            border:none;
            border-radius:8px;
            cursor:pointer;
        }

        .gallery{
            display:grid;
            grid-template-columns:repeat(auto-fill,160px);
            gap:15px;
            margin-top:15px;
        }

        .photo-card{
            background:#111;
            padding:10px;
            border-radius:10px;
            text-align:center;
            cursor:pointer;
        }

        .photo-card img{
            width:100%;
            border-radius:8px;
        }

        .error{
            color:#ffb4b4;
            text-align:center;
        }

        /* ===== Selected Image Preview ===== */
        .preview-box{
            margin-top:15px;
        }

        .preview-box img{
            width:220px;
            border-radius:10px;
            display:none;
            box-shadow:0 6px 18px rgba(0,0,0,0.5);
        }

        /* ===== Progress Overlay ===== */
        .overlay{
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:rgba(0,0,0,0.7);
            display:none;
            align-items:center;
            justify-content:center;
            z-index:9999;
        }

        .progress-box{
            background:#111;
            padding:25px;
            border-radius:12px;
            text-align:center;
            width:260px;
        }

        .progress-text{
            margin-bottom:15px;
        }

        .progress-bar{
            width:100%;
            height:12px;
            background:#333;
            border-radius:10px;
            overflow:hidden;
        }

        .progress-fill{
            width:0%;
            height:100%;
            background:#28a745;
            animation:loading 2s linear infinite;
        }

        @keyframes loading{
            0%{width:0%}
            50%{width:70%}
            100%{width:100%}
        }

        /* ===== RESULT PREVIEW MODAL ===== */
        .modal{
            display:none;
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:rgba(0,0,0,0.9);
            justify-content:center;
            align-items:center;
            flex-direction:column;
            z-index:10000;
        }

        .modal img{
            max-width:90%;
            max-height:85%;
            border-radius:14px;
            border:3px solid #28a745;
        }

        .close{
            position:absolute;
            top:20px;
            right:30px;
            font-size:40px;
            cursor:pointer;
            color:white;
        }

        .download-btn{
            margin-top:15px;
            padding:10px 18px;
            background:#28a745;
            color:black;
            border-radius:10px;
            text-decoration:none;
            font-weight:bold;
        }
    </style>
</head>
<body>

<!-- ===== PROGRESS OVERLAY ===== -->
<div class="overlay" id="loadingOverlay">
    <div class="progress-box">
        <div class="progress-text">üîç Searching Face...</div>
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        <p style="font-size:13px;margin-top:10px;">Please wait</p>
    </div>
</div>

<div class="container">
<h2>üîç Face Search</h2>

<div class="card">
<form method="POST" enctype="multipart/form-data" onsubmit="showLoader()">
    
    <input 
        type="file" 
        name="face_image" 
        accept="image/*" 
        capture="user" 
        required 
        onchange="showPreview(event)"
    >

    <!-- ===== PREVIEW IMAGE ===== -->
    <div class="preview-box">
        <img id="previewImage">
    </div>

    <br>
    <button class="btn">Search Face</button>
</form>

{% if error %}
<p class="error">{{ error }}</p>
{% endif %}
</div>

{% if results %}
<div class="card">
<h3>‚úÖ Matched Results</h3>

<div class="gallery">
{% for r in results %}
<div class="photo-card" onclick="openResult('{{ r.view_url }}','{{ r.id }}')">
    <img src="{{ r.view_url }}">
    <p>{{ r.name }}</p>
    <small>Distance: {{ r.distance }}</small>
</div>
{% endfor %}
</div>
</div>
{% endif %}

</div>

<!-- ===== RESULT MODAL ===== -->
<div id="resultModal" class="modal">
    <span class="close" onclick="closeResult()">√ó</span>
    <img id="resultImg">
    <a id="resultDownload" class="download-btn" download>‚¨á Download</a>
</div>

<script>
function showLoader(){
    document.getElementById("loadingOverlay").style.display = "flex";
}

function showPreview(event){
    const img = document.getElementById("previewImage");
    const file = event.target.files[0];

    if(file){
        img.src = URL.createObjectURL(file);
        img.style.display = "block";
    } else {
        img.style.display = "none";
    }
}

function openResult(src, filename){
    document.getElementById("resultImg").src = src;
    document.getElementById("resultDownload").href = "/download/" + filename;
    document.getElementById("resultModal").style.display = "flex";
}

function closeResult(){
    document.getElementById("resultModal").style.display = "none";
}
</script>

</body>
</html>
