<!DOCTYPE html>
<html>
<head>
    <title>Face Search</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body{
            background:#0f2027;
            color:white;
            font-family:Arial;
        }

        .container{
            max-width:900px;
            margin:auto;
            padding:20px;
        }

        .card{
            background:rgba(255,255,255,0.08);
            padding:20px;
            border-radius:12px;
            margin-top:20px;
            text-align:center;
        }

        .btn{
            background:#28a745;
            color:white;
            padding:12px 22px;
            border:none;
            border-radius:30px;
            cursor:pointer;
            font-size:15px;
            font-weight:bold;
        }

        /* ===== CUSTOM FILE INPUT ===== */
        .file-input{
            display:none;
        }

        .file-label{
            display:inline-block;
            background:#22c55e;
            color:black;
            padding:14px 26px;
            border-radius:40px;
            cursor:pointer;
            font-weight:bold;
            transition:0.3s;
        }

        .file-label:hover{
            transform:scale(1.05);
            box-shadow:0 8px 25px rgba(34,197,94,0.4);
        }

        .file-name{
            margin-top:10px;
            font-size:14px;
            color:#d1fae5;
        }

        .gallery{
            display:grid;
            grid-template-columns:repeat(auto-fill,160px);
            gap:15px;
            margin-top:15px;
        }

        .photo-card{
            background:#111;
            padding:10px;
            border-radius:10px;
            text-align:center;
            cursor:pointer;
        }

        .photo-card img{
            width:100%;
            border-radius:8px;
        }

        .error{
            color:#ffb4b4;
            text-align:center;
        }

        /* ===== PREVIEW ===== */
        .preview-box{
            margin-top:15px;
        }

        .preview-box img{
            width:220px;
            border-radius:10px;
            display:none;
            box-shadow:0 6px 18px rgba(0,0,0,0.5);
        }

        /* ===== LOADER ===== */
        .overlay{
            position:fixed;
            inset:0;
            background:rgba(0,0,0,0.7);
            display:none;
            align-items:center;
            justify-content:center;
            z-index:9999;
        }

        .progress-box{
            background:#111;
            padding:25px;
            border-radius:12px;
            text-align:center;
            width:260px;
        }

        .progress-fill{
            width:0%;
            height:12px;
            background:#28a745;
            animation:loading 2s linear infinite;
            border-radius:10px;
        }

        @keyframes loading{
            0%{width:0%}
            50%{width:70%}
            100%{width:100%}
        }

        /* ===== MODAL ===== */
        .modal{
            display:none;
            position:fixed;
            inset:0;
            background:rgba(0,0,0,0.9);
            justify-content:center;
            align-items:center;
            flex-direction:column;
            z-index:10000;
        }

        .modal img{
            max-width:90%;
            max-height:85%;
            border-radius:14px;
            border:3px solid #28a745;
        }

        .close{
            position:absolute;
            top:20px;
            right:30px;
            font-size:40px;
            cursor:pointer;
        }

        .download-btn{
            margin-top:15px;
            padding:10px 18px;
            background:#28a745;
            color:black;
            border-radius:10px;
            font-weight:bold;
            text-decoration:none;
        }
    </style>
</head>
<body>

<!-- ===== LOADER ===== -->
<div class="overlay" id="loadingOverlay">
    <div class="progress-box">
        <p>üîç Searching Face...</p>
        <div class="progress-fill"></div>
        <p style="font-size:13px;margin-top:10px;">Please wait</p>
    </div>
</div>

<div class="container">
<h2>üîç Face Search</h2>

<div class="card">
<form method="POST" enctype="multipart/form-data" onsubmit="showLoader()">

    <!-- CUSTOM FILE INPUT -->
    <label for="faceInput" class="file-label">
        üì∏ Choose Face Image
    </label>
    <input
        id="faceInput"
        class="file-input"
        type="file"
        name="face_image"
        accept="image/*"
        required
        onchange="showPreview(event)"
    >

    <div id="fileName" class="file-name"></div>

    <!-- PREVIEW -->
    <div class="preview-box">
        <img id="previewImage">
    </div>

    <br><br>
    <button class="btn">Search Face</button>
</form>

{% if error %}
<p class="error">{{ error }}</p>
{% endif %}
</div>

{% if results %}
<div class="card">
<h3>‚úÖ Matched Results</h3>

<div class="gallery">
{% for r in results %}
<div class="photo-card" onclick="openResult('{{ r.view_url }}','{{ r.id }}')">
    <img src="{{ r.view_url }}">
    <p>{{ r.name }}</p>
    <small>Distance: {{ r.distance }}</small>
</div>
{% endfor %}
</div>
</div>
{% endif %}

</div>

<!-- ===== RESULT MODAL ===== -->
<div id="resultModal" class="modal">
    <span class="close" onclick="closeResult()">√ó</span>
    <img id="resultImg">
    <a id="resultDownload" class="download-btn" download>‚¨á Download</a>
</div>

<script>
function showLoader(){
    document.getElementById("loadingOverlay").style.display="flex";
}

function showPreview(event){
    const img = document.getElementById("previewImage");
    const fileName = document.getElementById("fileName");
    const file = event.target.files[0];

    if(file){
        img.src = URL.createObjectURL(file);
        img.style.display="block";
        fileName.textContent = "Selected: " + file.name;
    }
}

function openResult(src, filename){
    document.getElementById("resultImg").src = src;
    document.getElementById("resultDownload").href = "/download/" + filename;
    document.getElementById("resultModal").style.display="flex";
}

function closeResult(){
    document.getElementById("resultModal").style.display="none";
}
</script>

</body>
</html>
